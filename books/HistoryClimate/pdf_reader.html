<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Читалка PDF: От каменного века до века железа</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            display: flex;
        }
        #sidebar {
            width: 250px;
            background: #e0e0e0;
            padding: 20px;
            height: 100vh;
            overflow-y: auto;
            border-right: 1px solid #ccc;
        }
        #canvas-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            height: 100vh;
        }
        #pdf-canvas {
            border: 1px solid #ddd;
            display: block;
            margin: 0 auto;
        }
        #page-controls {
            text-align: center;
            margin: 10px 0;
        }
        #zoom-controls {
            text-align: center;
            margin: 10px 0;
        }
        button {
            padding: 5px 10px;
            margin: 0 5px;
        }
        #page-num {
            width: 50px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="sidebar">
        <h3>Меню глав</h3>
        <ul>
            <li><a href="#" onclick="goToPage(1)">Титульный лист (стр. 1)</a></li>
            <li><a href="#" onclick="goToPage(2)">Введение (стр. 2)</a></li>
            <li><a href="#" onclick="goToPage(4)">Глава 1. Климат и история (стр. 4)</a></li>
            <li><a href="#" onclick="goToPage(36)">Глава 2. Эти таинственные шумеры (стр. 36)</a></li>
            <li><a href="#" onclick="goToPage(70)">Глава 3. Убейдцы и шумеры (стр. 70)</a></li>
            <li><a href="#" onclick="goToPage(109)">Глава 4. Конец периода Джемдет-Наср. Первые династии (стр. 109)</a></li>
            <li><a href="#" onclick="goToPage(131)">Глава 5. Войны номов (стр. 131)</a></li>
            <li><a href="#" onclick="goToPage(149)">Глава 6. Расцвет и гибель Аккадского царства (стр. 149)</a></li>
            <li><a href="#" onclick="goToPage(165)">Глава 7. Возвышение Ура и появление амореев (стр. 165)</a></li>
            <li><a href="#" onclick="goToPage(192)">Глава 8. Ближний Восток в ХVI-ХIV веках до н. э. (стр. 192)</a></li>
            <li><a href="#" onclick="goToPage(217)">Глава 9. Коллапс бронзового века (стр. 217)</a></li>
            <li><a href="#" onclick="goToPage(253)">Глава 10. Современные изменения климата и их последствия (стр. 253)</a></li>
        </ul>
    </div>
    <div id="canvas-container">
        <div id="page-controls">
            <button id="prev">Предыдущая</button>
            <span>Страница <input type="number" id="page-num" min="1"> из <span id="page-count"></span></span>
            <button id="next">Следующая</button>
        </div>
        <div id="zoom-controls">
            <button id="zoom-out">-</button>
            <span>Масштаб: <span id="zoom-level">100</span>%</span>
            <button id="zoom-in">+</button>
        </div>
        <canvas id="pdf-canvas"></canvas>
    </div>

    <!-- Load PDF.js from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script>
        // Set the worker source for PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

        let pdfDoc = null;
        let pageNum = 1;
        let pageRendering = false;
        let pageNumPending = null;
        let scale = 1.0;
        const canvas = document.getElementById('pdf-canvas');
        const ctx = canvas.getContext('2d');

        // Hard-coded PDF file name in the same directory
        const pdfUrl = 'History_Climate.pdf';
        pdfjsLib.getDocument(pdfUrl).promise.then((doc) => {
            pdfDoc = doc;
            document.getElementById('page-count').textContent = pdfDoc.numPages;
            renderPage(pageNum);
        }).catch(err => {
            console.error('Error loading PDF:', err);
            alert('Не удалось загрузить PDF. Убедитесь, что файл History_Climate.pdf находится в той же директории.');
        });

        function renderPage(num) {
            pageRendering = true;
            document.getElementById('page-num').value = num;
            pdfDoc.getPage(num).then((page) => {
                const viewport = page.getViewport({ scale: scale });
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                const renderContext = {
                    canvasContext: ctx,
                    viewport: viewport
                };
                page.render(renderContext).promise.then(() => {
                    pageRendering = false;
                    if (pageNumPending !== null) {
                        renderPage(pageNumPending);
                        pageNumPending = null;
                    }
                });
            });
        }

        function goToPage(num) {
            pageNum = num;
            if (pageRendering) {
                pageNumPending = pageNum;
            } else {
                renderPage(pageNum);
            }
            document.getElementById('page-num').value = pageNum;
        }

        document.getElementById('prev').addEventListener('click', () => {
            if (pageNum <= 1) return;
            pageNum--;
            if (pageRendering) {
                pageNumPending = pageNum;
            } else {
                renderPage(pageNum);
            }
        });

        document.getElementById('next').addEventListener('click', () => {
            if (pageNum >= pdfDoc.numPages) return;
            pageNum++;
            if (pageRendering) {
                pageNumPending = pageNum;
            } else {
                renderPage(pageNum);
            }
        });

        document.getElementById('page-num').addEventListener('change', (e) => {
            const newPage = parseInt(e.target.value, 10);
            if (newPage >= 1 && newPage <= pdfDoc.numPages) {
                pageNum = newPage;
                if (!pageRendering) {
                    renderPage(pageNum);
                } else {
                    pageNumPending = pageNum;
                }
            } else {
                e.target.value = pageNum;
            }
        });

        document.getElementById('zoom-in').addEventListener('click', () => {
            scale += 0.2;
            renderPage(pageNum);
            document.getElementById('zoom-level').textContent = Math.round(scale * 100);
        });

        document.getElementById('zoom-out').addEventListener('click', () => {
            if (scale > 0.2) {
                scale -= 0.2;
                renderPage(pageNum);
                document.getElementById('zoom-level').textContent = Math.round(scale * 100);
            }
        });
    </script>
</body>
</html>